/*
MediaPlayerLib
Copyright Â©2012 Joshfire.
Library may be freely distributed under the MIT license.
For all details and documentation:
 http://github.com/joshfire/mediaplayerlib/
*/(function(a){var b=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},c=function(a){if(a["@type"]==="VideoObject"||a["@type"]==="AudioObject")return a;var b=["video","audio","associatedMedia"];for(var c=0,d=b.length;c<d;c++){var e=b[c];if(typeof a[e]!="undefined")return a[e]}},d=function(a,b){b=b||{},a=a||{};var c={width:b.width||500,height:b.height||281};a["@type"]==="AudioObject"&&(c.height=b.height||40);if(b.adjustSize){var d=4/3;a.width&&a.height?d=a.width/a.height:a["yt:aspectRatio"]==="widescreen"&&(d=16/9);var e={width:Math.round(c.height*d),height:Math.round(c.width/d)};e.width>c.width+1?c.height=e.height:e.width<c.width-1&&(c.width=e.width)}return c},e=function(a){typeof this.initialize=="function"?this.initialize(a):e.prototype.initialize.call(this,a)};e.extend=function(a){var c=function(a){e.call(this,a)};return b(c.prototype,a),c},b(e.prototype,{initialize:function(a){},toHtml:function(a){typeof a=="function"&&a(null,"",{})}});var f=function(a){if(a.match(/soundcloud/g))return"audio/mp3";var b=a.split(".").pop();switch(b){case"webm":return"video/webm";case"ogv":return"video/ogg";case"mp4":return"video/mp4";case"m4v":return"video/mp4";case"ogg":return"audio/ogg";case"mp3":return"audio/mp3";case"m4a":return"audio/mp4";default:return""}},g=e.extend({initialize:function(a){this.sources=a.sources,this.poster=a.poster,this.width=a.width||500,this.height=a.height||281,this.autoPlay=a.autoPlay||!1},toHtml:function(a){var b=this.poster?' poster="'+this.poster+'"':"",c=this.autoPlay?" autoplay":"",d='<video width="'+this.width+'" height="'+this.height+'" '+b+c+" controls "+'class="video-js vjs-default-skin" data-setup="{}">';for(var e=0;e<this.sources.length;e++){var g=this.sources[e];d+='<source src="'+g+'"  type="'+f(g)+'" />'}d+="</video>",typeof a=="function"&&a(null,d,{width:this.width,height:this.height})}}),h=e.extend({initialize:function(a){this.sources=a.sources,this.poster=a.poster||"",this.width=a.width||500,this.height=a.height||281,this.autoPlay=a.autoPlay||!1},addPolyFill:function(){var a=document.getElementsByTagName("body")[0],b=document.createElement("link"),c=document.createElement("script");b.setAttribute("href","http://vjs.zencdn.net/c/video-js.css"),b.setAttribute("rel","stylesheet"),c.setAttribute("src","http://vjs.zencdn.net/c/video.js"),a.appendChild(b),a.appendChild(c)},toHtml:function(a){var b=this.poster?' poster="'+this.poster+'"':"",c=this.autoPlay?" autoplay":"",d='<video width="'+this.width+'" height="'+this.height+'" '+b+c+" controls"+' class="video-js vjs-default-skin" data-setup="{}">';for(var e=0;e<this.sources.length;e++){var g=this.sources[e];d+='<source src="'+g+'"  type="'+f(g)+'" />'}d+="</video>",typeof window!="undefined"&&typeof window.VideoJS=="undefined"&&this.addPolyFill(),typeof a=="function"&&a(null,d,{width:this.width,height:this.height})}}),i=e.extend({initialize:function(a){this.sources=a.sources,this.width=a.width||500,this.height=a.height||40,this.autoPlay=a.autoPlay||!1},iCanHazAudioTag:function(a){if(!document)return!1;var b=document.createElement("audio");return b.canPlayType},toHtml:function(a){var b="";if(this.sources&&this.sources.length){for(var c=0;c<this.sources.length;c++)if(this.iCanHazAudioTag(this.sources[c])){var d=this.autoPlay?" autoplay":"";b='<audio controls src="'+this.sources[c]+'"'+d+" />";break}b||(b='<a href="'+this.sources[0]+'" target="_blank">Play</a>')}typeof a=="function"&&a(null,b,{})}}),j=e.extend({initialize:function(a){this.sources=a.sources,this.width=a.width||500,this.height=a.height||281,this.autoPlay=a.autoPlay||!1},toHtml:function(a){var b="mediaplayerlib-mediaelement-video-"+j.nextId++,c=this.poster?' poster="'+this.poster+'"':"",d=this.autoPlay?" autoplay":"",e='<video width="'+this.width+'" height="'+this.height+'" '+c+d+" controls"+' id="'+b+'">';for(var f=0;f<this.sources.length;f++){var g=this.sources[f];e+='<source src="'+g+'" />'}e+="</video>",e+="<script>",e+='$("#'+b+'").mediaelementplayer({',e+="playerWidth: "+this.width+",",e+="playerHeight: "+this.height,e+="});",e+="</script>",typeof a=="function"&&a(null,e,{width:this.width,height:this.height})}});j.nextId=0;var k=e.extend({initialize:function(a){this.options=a},toHtml:function(b){var c=null;for(var d=0;d<k.endPoints.length;d++)this.options.url.match(k.endPoints[d].regexp)&&(c=k.endPoints[d]);if(!c){typeof b=="function"&&b(null,null);return}if(typeof module!="undefined"){var e=c.url(null,this.options),f=require("http"),g=require("url"),h=g.parse(e),i={host:h.hostname,path:h.pathname+h.search,port:80,method:"GET"},j=f.request(i,function(a){var c="";a.on("data",function(a){c+=a}),a.on("end",function(){typeof b!="undefined"&&b(null,JSON.parse(c).html)}),a.on("close",function(a){typeof b!="undefined"&&b(a)})});j.on("error",function(a){typeof b!="undefined"&&b(a)}),j.end()}else{var l=k.cbName(),g=c.url(l,this.options),m=document.getElementsByTagName("body")[0],n=document.createElement("script");a[l]=function(c){m.removeChild(n),delete a[l],typeof b=="function"&&b(null,c.html)},n.setAttribute("src",g),m.appendChild(n)}}});k.endPoints=[{regexp:/soundcloud\.com/i,url:function(a,b){var c=null;return a?c="http://soundcloud.com/oembed?format=js&callback="+a+"&url="+encodeURIComponent(b.url):c="http://soundcloud.com/oembed?format=json&url="+encodeURIComponent(b.url),b.width&&(c+="&maxwidth="+b.width),b.height&&(c+="&maxheight="+b.height),c}},{regexp:/vimeo\.com/i,url:function(a,b){var c=null;return a?c="http://vimeo.com/api/oembed.json?callback="+a+"&url="+encodeURIComponent(b.url):c="http://vimeo.com/api/oembed.json?url="+encodeURIComponent(b.url),b.width&&(c+="&width="+b.width),b.height&&(c+="&height="+b.height),c}},{regexp:/slideshare\.net/i,url:function(a,b){var c=null;return a?c="http://www.slideshare.net/api/oembed/2?format=jsonp&callback="+a+"&url="+encodeURIComponent(b.url):c="http://www.slideshare.net/api/oembed/2?url="+encodeURIComponent(b.url),b.width&&(c+="&maxwidth="+b.width),b.height&&(c+="&maxheight="+b.height),c}}],k.numCbName=0,k.cbName=function(){return"OEmbedCallBack"+k.numCbName++};var l=e.extend({initialize:function(a){this.url=a.url,this.width=a.width||500,this.height=a.height||281;var b=this.url.match(/youtube/gi),c=this.url.match(/vimeo/gi);a.html5&&b&&(this.url.indexOf("?")===-1?this.url+="?html5=1":this.url+="&html5=1"),a.autoPlay&&(b||c)&&(this.url.indexOf("?")===-1?this.url+="?autoplay=1":this.url+="&autoplay=1")},toHtml:function(a){var b='<iframe src="'+this.url+'" width="'+this.width+'" height="'+this.height+'" frameborder="0"></iframe>';typeof a=="function"&&a(null,b,{width:this.width,height:this.height})}}),m=e.extend({initialize:function(a){this.url=a.url,this.publisher=a.publisher,this.width=a.width||500,this.height=a.height||281},toHtml:function(a){var b=this.url||"",c="",d="",e=function(){var a=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return"mediaplayerlib-"+a()+a()+a()};d=e(),this.publisher==="Ooyala"?(b+=(b.indexOf("?")===-1?"?":"&amp;")+"width="+encodeURIComponent(this.width)+"&amp;height="+encodeURIComponent(this.height),c='<div id="'+d+'"></div>'+'<script type="text/javascript">'+'document.getElementById("'+d+'").appendChild(document.createElement("script"));'+'window.ooyalaActiveScript = document.getElementById("'+d+'").firstChild;'+"</script>"+'<script type="text/javascript" src="'+b+'"></script>'):c='<script type="text/javascript" src="'+b+'"></script>',typeof a=="function"&&a(null,c,{width:this.width,height:this.height})}}),n=e.extend({toHtml:function(a){typeof a=="function"&&a(new Error("Unknown media type."),"Unknown media type.")}}),o=function(){};b(o.prototype,{execute:function(a,b){return new n(b)}}),o.extend=function(a){var c=function(a){o.call(this,a)};return b(c.prototype,a),c};var p=o.extend({execute:function(a,e){var f,g=c(a)||{},i=d(g,e);b(e,i);if(g["@type"]==="VideoObject")if(g.playerType==="iframe")b(e,{url:g.embedURL}),f=new l(e);else if(g.playerType==="script")b(e,{url:g.embedURL,publisher:g.publisher?g.publisher.name:null}),f=new m(e);else if(g.contentURL){var j=null;g.image&&g.image.contentURL&&(j=g.image.contentURL),b(e,{poster:j,sources:[g.contentURL]}),f=new h(e)}return f||new n}}),q=o.extend({execute:function(a,e){var f,h=c(a)||{},j=d(h,e);b(e,j);if(h.playerType==="iframe")b(e,{url:h.embedURL,html5:!0}),f=new l(e);else if(h.playerType==="script")b(e,{url:h.embedURL,html5:!0,publisher:h.publisher?h.publisher.name:null}),f=new m(e);else if(h["@type"]==="VideoObject"){if(h.contentURL){var k=null;h.image&&(k=h.image.contentURL),b(e,{poster:k,sources:[h.contentURL]}),f=new g(e)}}else h["@type"]==="AudioObject"&&h.contentURL&&(b(e,{sources:[h.contentURL]}),f=new i(e));return f}}),r=o.extend({execute:function(a,e){var f=c(a)||{},g=d(f,e);b(e,g);var h;if(a["@type"]==="VideoObject"){if(typeof a.contentURL!="undefined"){var i=null;f.image&&(i=f.image.contentURL),b(e,{poster:i,sources:[a.contentURL]}),h=new j(e)}}else a["@type"]==="AudioObject"&&typeof a.contentURL!="undefined"&&b(e,{sources:[a.contentURL]});return h}}),s=o.extend({execute:function(a,c){var d;return typeof a.url!="undefined"&&(b(c,{url:a.url}),d=new k(c)),d}}),t=function(){this.strategies={def:new p,html5:new q,mediaElement:new r,oembed:new s}};b(t.prototype,{resolve:function(a,b){b=b||{};var c;if(typeof b.strategy!="undefined"&&typeof this.strategies[b.strategy]!="undefined"){var d=this.strategies[b.strategy];c=d.execute(a,b)}return c||this.strategies.def.execute(a,b)},insertFragment:function(a,b){function d(a,b){b(a);for(var c in a.childNodes)d(a.childNodes[c],b)}function e(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()}function f(a){var b=a.text||a.textContent||a.innerHTML||"",c=a.getAttribute("src"),d=document.getElementsByTagName("head")[0]||document.documentElement,e=document.createElement("script");e.type="text/javascript",c&&e.setAttribute("src",c),b&&e.appendChild(document.createTextNode(b)),d.insertBefore(e,d.firstChild),a.parentNode&&a.parentNode.removeChild(a)}var c=null;Object.prototype.toString.call(b)==="[object String]"?c=document.getElementById(b):c=b,c.innerHTML=(""+a).trim();var g=[],h=null;d(c,function(a){a.nodeName&&a.nodeName.toUpperCase()==="SCRIPT"&&(!a.type||a.type==="text/javascript")&&g.push(a)});for(h in g)f(g[h])},insert:function(a,b,c,d){var e=this,f=this.resolve(a,b).toHtml(function(a,b){e.insertFragment(b,c),typeof d=="function"&&d(null)})}}),typeof Joshfire!="undefined"&&typeof Joshfire.define!="undefined"?Joshfire.define([],function(){return new t}):typeof define!="undefined"?define([],function(){return new t}):a.mediaFactory=new t})(typeof module!="undefined"?module.exports:window);