/**
 * Play media on all devices!
 *
 * Example:
 *
 *   mediaFactory.resolve(myVideoObject).toHtml(function(err, html) {
 *     // Do something with the returned HTML
 *     // Beware, the returned HTML may contain <script> tags that
 *     // are necessary for the player to work correctly. Such <script>
 *     // tags won't be run when using 'innerHTML' or 'document.write'.
 *     // Use the 'insertFragment' method or a JavaScript framework such
 *     // as jQuery to handle script tags correctly.
 *     mediaFactory.insertFragment(html, 'myplayerid');
 *   });
 *
 *   mediaFactory.insert(myVideoObject, null, 'myplayerid', function (err) {
 *     // Check error
 *   });
 */(function(a){var b=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},c=function(a){typeof this.initialize=="function"?this.initialize(a):c.prototype.initialize.call(this,a)};c.extend=function(a){var d=function(a){c.call(this,a)};return b(d.prototype,a),d},b(c.prototype,{initialize:function(a){},toHtml:function(a){typeof a=="function"&&a(null,"")}});var d=function(a){var b=a.split(".").pop();switch(b){case"webm":return"video/webm";case"ogv":return"video/ogg";case"mp4":return"video/mp4";default:return"video/mp4"}},e=c.extend({initialize:function(a){this.sources=a.sources,this.poster=a.poster||"",this.width=a.width||500,this.height=a.height||281},toHtml:function(a){var b="";this.poster?b+='<video width="'+this.width+'" height="'+this.height+'" poster="'+this.poster+'" controls>':b+='<video width="'+this.width+'" height="'+this.height+'" controls>';for(var c=0;c<this.sources.length;c++){var e=this.sources[c];b+='<source src="'+e+'"  type="'+d(e)+'" />'}b+="</video>",typeof a=="function"&&a(null,b)}}),f=c.extend({initialize:function(a){this.sources=a.sources,this.poster=a.poster||"",this.width=a.width||500,this.height=a.height||281},addPolyFill:function(){var a=document.getElementsByTagName("body")[0],b=document.createElement("link"),c=document.createElement("script");b.setAttribute("href","http://vjs.zencdn.net/c/video-js.css"),b.setAttribute("rel","stylesheet"),c.setAttribute("src","http://vjs.zencdn.net/c/video.js"),a.appendChild(b),a.appendChild(c)},toHtml:function(a){var b="";this.poster?b+='<video width="'+this.width+'" height="'+this.height+'" poster="'+this.poster+'" controls'+' class="video-js vjs-default-skin" data-setup="{}">':b+='<video width="'+this.width+'" height="'+this.height+'" controls class="video-js vjs-default-skin"'+' data-setup="{}">';for(var c=0;c<this.sources.length;c++){var e=this.sources[c];b+='<source src="'+e+'"  type="'+d(e)+'" />'}b+="</video>",typeof window!="undefined"&&typeof window.VideoJS=="undefined"&&this.addPolyFill(),typeof a=="function"&&a(null,b)}}),g=c.extend({initialize:function(a){this.options=a},toHtml:function(b){var c=null;for(var d=0;d<g.endPoints.length;d++)this.options.url.match(g.endPoints[d].regexp)&&(c=g.endPoints[d]);if(!c){typeof b=="function"&&b(null,null);return}if(typeof module!="undefined"){var e=c.url(null,this.options),f=require("http"),h=require("url");urlObj=h.parse(e);var i={host:urlObj.hostname,path:urlObj.pathname+urlObj.search,port:80,method:"GET"},j=f.request(i,function(a){var c="";a.on("data",function(a){c+=a}),a.on("end",function(){typeof b!="undefined"&&b(null,JSON.parse(c).html)}),a.on("close",function(a){typeof b!="undefined"&&b(a)})});j.on("error",function(a){typeof b!="undefined"&&b(a)}),j.end()}else{var k=g.cbName(),h=c.url(k,this.options),l=document.getElementsByTagName("body")[0],m=document.createElement("script");a[k]=function(c){l.removeChild(m),delete a[k],typeof b=="function"&&b(null,c.html)},m.setAttribute("src",h),l.appendChild(m)}}});g.endPoints=[{regexp:/soundcloud\.com/i,url:function(a,b){if(a)var c="http://soundcloud.com/oembed?format=js&callback="+a+"&url="+encodeURIComponent(b.url);else c="http://soundcloud.com/oembed?format=json&url="+encodeURIComponent(b.url);return b.width&&(c+="&maxwidth="+b.width),b.height&&(c+="&maxheight="+b.height),c}},{regexp:/vimeo\.com/i,url:function(a,b){if(a)var c="http://vimeo.com/api/oembed.json?callback="+a+"&url="+encodeURIComponent(b.url);else c="http://vimeo.com/api/oembed.json?url="+encodeURIComponent(b.url);return b.width&&(c+="&width="+b.width),b.height&&(c+="&height="+b.height),c}},{regexp:/slideshare\.net/i,url:function(a,b){if(a)var c="http://www.slideshare.net/api/oembed/2?format=jsonp&callback="+a+"&url="+encodeURIComponent(b.url);else c="http://www.slideshare.net/api/oembed/2?url="+encodeURIComponent(b.url);return b.width&&(c+="&maxwidth="+b.width),b.height&&(c+="&maxheight="+b.height),c}}],g.numCbName=0,g.cbName=function(){return"OEmbedCallBack"+g.numCbName++};var h=c.extend({initialize:function(a){this.url=a.url,this.width=a.width||500,this.height=a.height||281,a.html5&&!this.url.indexOf("?"),a.autoPlay&&(this.url.indexOf("?")?this.url+="&autoplay=1":this.url+="?autoplay=1")},toHtml:function(a){var b='<iframe src="'+this.url+'" width="'+this.width+'" height="'+this.height+'" frameborder="0"></iframe>';typeof a=="function"&&a(null,b)}}),i=c.extend({initialize:function(a){this.url=a.url,this.publisher=a.publisher,this.width=a.width||500,this.height=a.height||281},toHtml:function(a){var b=this.url||"",c="",d="",e=function(){var a=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return"mediaplayerlib-"+a()+a()+a()};d=e(),this.publisher==="Ooyala"?(b+=(b.indexOf("?")===-1?"?":"&amp;")+"width="+this.width+"&amp;height="+this.height,c='<div id="'+d+'"></div>'+'<script type="text/javascript">'+'document.getElementById("'+d+'").appendChild(document.createElement("script"));'+'window.ooyalaActiveScript = document.getElementById("'+d+'").firstChild;'+"</script>"+'<script type="text/javascript" src="'+b+'"></script>'):c='<script type="text/javascript" src="'+b+'"></script>',typeof a=="function"&&a(null,c)}}),j=c.extend({toHtml:function(a){typeof a=="function"&&a(new Error("Unknown media type."),"Unknown media type.")}}),k=function(){};b(k.prototype,{execute:function(a,b){return new j(b)}}),k.extend=function(a){var d=function(a){c.call(this,a)};return b(d.prototype,a),d};var l=c.extend({execute:function(a,c){var d;if(a["@type"]==="VideoObject")if(a.playerType==="iframe")b(c,{url:a.embedURL}),d=new h(c);else if(a.playerType==="script")b(c,{url:a.embedURL,publisher:a.publisher?a.publisher.name:null}),d=new i(c);else if(a.contentURL){var e=null;a.image&&(e=a.image.contentURL),b(c,{poster:e,sources:[a.contentURL]}),d=new f(c)}return d||new j}}),m=c.extend({execute:function(a,c){var d;if(a["@type"]==="VideoObject")if(a.playerType==="iframe")b(c,{url:a.embedURL,html5:!0}),d=new h(c);else if(a.playerType==="script")b(c,{url:a.embedURL,html5:!0,publisher:a.publisher?a.publisher.name:null}),d=new i(c);else if(!a.playerType&&a.contentURL){var f=null;a.image&&(f=a.image.contentURL),b(c,{poster:f,sources:[a.contentURL]}),d=new e(c)}return d}}),n=c.extend({execute:function(a,c){var d;return typeof a.url!="undefined"&&(b(c,{url:a.url}),d=new g(c)),d}}),o=function(){this.strategies={def:new l,html5:new m,oembed:new n}};b(o.prototype,{resolve:function(a,b){b=b||{};var c;if(typeof b.strategy!="undefined"&&typeof this.strategies[b.strategy]!="undefined"){var d=this.strategies[b.strategy];c=d.execute(a,b)}return c||this.strategies.def.execute(a,b)},insertFragment:function(a,b){function d(a,b){b(a);for(var c in a.childNodes)d(a.childNodes[c],b)}function e(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()}function f(a){var b=a.text||a.textContent||a.innerHTML||"",c=a.getAttribute("src"),d=document.getElementsByTagName("head")[0]||document.documentElement,e=document.createElement("script");e.type="text/javascript",c&&e.setAttribute("src",c),b&&e.appendChild(document.createTextNode(b)),d.insertBefore(e,d.firstChild),a.parentNode&&a.parentNode.removeChild(a)}var c=null;Object.prototype.toString.call(b)==="[object String]"?c=document.getElementById(b):c=b,c.innerHTML=(""+a).trim();var g=[],h=null;d(c,function(a){a.nodeName&&a.nodeName.toUpperCase()==="SCRIPT"&&(!a.type||a.type==="text/javascript")&&g.push(a)});for(h in g)f(g[h])},insert:function(a,b,c,d){var e=this,f=this.resolve(a,b).toHtml(function(a,b){e.insertFragment(b,c),typeof d=="function"&&d(null)})}}),typeof Joshfire!="undefined"&&typeof Joshfire.define!="undefined"?Joshfire.define([],function(){return new o}):typeof define!="undefined"?define([],function(){return new o}):a.mediaFactory=new o})(typeof module!="undefined"?module.exports:window);